# Python 3 
winget install -e --id Python.Python.3.12

# Git 
winget install -e --id Git.Git

# PostgreSQL 
# Depois de instalar, crie a database 'pcs3643' 
winget install -e --id PostgreSQL.PostgreSQL

# Clonar o repositório e ir para a branch do backend
git clone https://github.com/jojimaaa/pcs3643-login

# Ir para o diretório do backend
cd pcs3643-login/backend-login

# Criar e ativar a venv + permitir scripts

# Permitir ativação de venv
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned -Force

# Criar/ativar venv
py -m venv .venv
.\.venv\Scripts\Activate.ps1

# Atualizar pip
py -m pip install --upgrade pip

# Instalar dependências do backend
py -m pip install fastapi "uvicorn[standard]" sqlmodel "psycopg[binary]" alembic python-dotenv "python-jose[cryptography]" "passlib[bcrypt]" pydantic[email] python-multipart watchfiles

# Preparar o PostgreSQL e a URL do banco
# Abre o psql e cria a DB 
psql -U postgres -h localhost -c "CREATE DATABASE pcs3643;"

$env:JWT_KEY = "pcs3643_jwtkey_123456789_abcdefg"
$env:DATABASE_URL = "postgresql+psycopg://postgres:postgres@localhost:5432/pcs3643"


# Subir API
py -m uvicorn app.main:app --reload --port 8000
